(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2049c7a0"],{"0031":function(e,t,i){"use strict";i("fab1")},"0683":function(e,t,i){e.exports=i.p+"img/img.f335936e.svg"},3167:function(e,t,i){e.exports=i.p+"img/deleteSvg.b19a4cd1.svg"},"38ce":function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"mobile-title"},[t("navBar",{attrs:{titleText:e.titleText,svgIcon:e.close},on:{changeClose:e.changeClose}})],1),"问题处理"==e.titleText?t("div",[t("div",{staticClass:"mobile-body"},[t("van-cell",{attrs:{center:"",title:"承包商处理人",label:this.userName?this.userName:"无"}}),t("div",{staticClass:"item"},[e._m(0),t("div",{staticClass:"time-frame"},[t("img",{attrs:{src:e.date}}),t("span",[e._v(e._s((new Date).toLocaleDateString().replace(/\//g,"-")))])])]),t("div",{staticClass:"item"},[t("p",[e._v("问题图片")]),e._l(e.problemImg,(function(i){return t("div",{key:i.id,staticClass:"img-frame",staticStyle:{margin:"0.5rem 0rem"},on:{click:function(t){return e.showImg(i.imgPath)}}},[t("img",{attrs:{src:e.img}}),t("span",[e._v(e._s(i.imgName))])])})),t("van-uploader",{ref:"vanUploader",staticStyle:{display:"none"},attrs:{"show-upload":!0,"after-read":e.afterRead}}),t("img",{attrs:{src:e.add_img},on:{click:function(t){return e.$refs.vanUploader.chooseFile()}}})],2),t("div",{staticClass:"item",staticStyle:{"margin-top":"2.625rem"}},[t("p",[e._v("转发 ")]),t("van-dropdown-menu",{attrs:{"get-container":"body"}},[t("van-dropdown-item",{attrs:{title:e.forwardTitle,options:e.forward},on:{change:e.handelChange},model:{value:e.forwardValue,callback:function(t){e.forwardValue=t},expression:"forwardValue"}})],1)],1)],1),t("van-popup",{staticClass:"time-popup",style:{width:"70%"},attrs:{round:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("h3",[e._v("选择时间")]),t("p",{staticStyle:{"text-align":"center"}},[t("span",{on:{click:function(t){return e.changeTimeType("date")}}},[e._v(e._s(e.curDateText))]),e._v(" "),t("span",{on:{click:function(t){return e.changeTimeType("time")}}},[e._v(e._s(e.curTimeText))])]),t("van-datetime-picker",{attrs:{type:e.timeType},on:{confirm:e.confirm,cancel:e.cancel,change:e.timeChange},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1)],1):t("div",[t("div",{staticClass:"mobile-body"},[t("van-cell",{attrs:{center:"",title:"验证人",label:this.userName?this.userName:"无"}}),t("div",{staticClass:"item"},[e._m(1),t("van-dropdown-menu",{attrs:{"get-container":"body"}},[t("van-dropdown-item",{attrs:{title:e.completionTitle,options:e.completion},on:{change:e.completionChange},model:{value:e.completionValue,callback:function(t){e.completionValue=t},expression:"completionValue"}})],1)],1),t("div",{staticClass:"item"},[t("p",[e._v("问题验证时间")]),t("div",{staticClass:"time-frame"},[t("img",{attrs:{src:e.date}}),t("span",[e._v(e._s((new Date).toLocaleDateString().replace(/\//g,"-")))])])]),t("div",{staticClass:"item"},[t("p",[e._v("验证意见")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.description,expression:"description"}],attrs:{cols:"30",rows:"5",placeholder:"请输入"},domProps:{value:e.description},on:{input:function(t){t.target.composing||(e.description=t.target.value)}}})])],1)]),t("van-button",{staticClass:"float-button",attrs:{round:"",type:"info",block:""},on:{click:e.submit}},[e._v("提交")])],1)},n=[function(){var e=this,t=e._self._c;return t("p",[e._v("问题整改完成时间 "),t("span",{staticStyle:{color:"#f20909"}},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("完成情况 "),t("span",{staticStyle:{color:"#f20909"}},[e._v("*")])])}],o=(i("b7ef"),i("907a"),i("3c5d"),i("fa9e"),i("77d9"),i("da1d")),s=i("28a2"),l={name:"ProblemMangeHandling",components:{navBar:o["a"]},data(){return{titleText:"",show:!1,currentDate:null,timeType:"date",showTime:"请选择时间",curDateText:"",curTimeText:"",overTime:"",problemImg:[],pictureId:[],forwardValue:"",forwardTitle:"",forward:[],userName:"",problemList:[],justProblem:[],close:i("bf37"),date:i("8a32"),img:i("0683"),add_img:i("81a9"),questionId:"",justType:"",completion:[{text:"合格",value:0},{text:"不合格",value:1}],completionTitle:"",completionValue:"",description:""}},methods:{afterRead(e){function t(e,t){let i=e.split(","),a=i[0].match(/:(.*?);/)[1],n=atob(i[1]),o=n.length,s=new Uint8Array(o);while(o--)s[o]=n.charCodeAt(o);return new File([s],t,{type:a})}console.log("afterRead",e);const i=new FormData;i.append("uploadFile",t(e.content,e.file.name)),console.log("fromData",i),this.$postHttp(this.$baseUrl+"/CMS/file/upload",i).then(e=>{console.log("upload",e),200==e.status&&(this.pictureId.push(e.data.data.id),this.problemImg.push({imgName:e.data.data.fileName+"."+e.data.data.fileType,imgPath:e.data.data.filePath,id:e.data.data.id}))}).catch(e=>{})},changeClose(){this.reset(),this.$emit("changeCloseHandling")},handleTime(){this.show=!0,this.timeType="date",this.getCurTime(new Date)},showImg(e){Object(s["a"])([e])},handelChange(e){this.forward.forEach(t=>{t.value===e&&(this.forwardTitle=t.text)})},completionChange(e){this.completion.forEach(t=>{t.value===e&&(this.completionTitle=t.text)})},confirm(e){this.show=!1,this.getCurTime(e,!0)},cancel(e){this.show=!1},timeChange(e,t,i){if("time"==this.timeType){let t=e.getValues();this.curTimeText=t[0]+":"+t[1]+this.curTimeText.slice(5),this.overTime=this.overTime.slice(0,11)+t[0]+":"+t[1]}},changeTimeType(e){"time"==e&&this.getCurTime(this.currentDate,!0),this.timeType=e},submit(){if("问题处理"==this.titleText)this.$getHttp(this.$baseUrl+"/CMS/agreementquestionmanagement/personCommit",{params:{questionId:this.questionId,type:this.justType,personId:this.forwardValue,fileId:this.pictureId?this.pictureId.toString():"",name:this.forwardTitle,overTime:(new Date).toLocaleDateString().replace(/\//g,"-")}}).then(e=>{console.log("personCommit",e),200==e.status&&this.$emit("changeCloseHandling",!0)});else{if(""==this.completionTitle)return void alert("请选择完成情况");this.$getHttp(this.$baseUrl+"/CMS/agreementquestionmanagement/questionValidate",{params:{questionId:this.questionId,state:"合格"==this.completionTitle?"COMMIT":"SAVE",comment:this.description}}).then(e=>{console.log("questionValidate",e),200==e.status&&this.$emit("changeCloseHandling")})}},getCurTime(e,t){let i,a,n;"time"==this.timeType?this.curTimeText=e+this.curTimeText.slice(5):(i=e.toLocaleDateString().split("/")[0],a=e.toLocaleDateString().split("/")[1]-1,n=e.toLocaleDateString().split("/")[2],t||(this.overTime=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")),this.curDateText=i+"年"+(a+1)+"月"+n+"日",this.curTimeText=this.overTime.split(" ")[1]),t&&(this.showTime=this.curDateText+" "+this.curTimeText),this.currentDate=new Date(i,a,n)},async getUserName(){const e=await this.$getHttp(this.$baseUrl+"/CMS/uams/getUserInfo");console.log("getUserInfonb1",e),200==e.status&&(this.userName=e.data.name,console.log("this.userName",this.userName))},getCurProblem(e){let t="";this.$postHttp(this.$baseUrl+"/CMS/agreementquestionmanagement/getQuestion",{id:e}).then(e=>{console.log("获取当前这条问题的信息",e,"当前用户",this.userName),200==e.data.code&&(e.data.data.question[0].conperson==this.userName?(t=e.data.data.question[0].contractor,this.justType="con"):e.data.data.question[0].supPerson==this.userName?(t=e.data.data.question[0].supervisory_unit,this.justType="sup"):(t=e.data.data.question[0].territorial_unit,this.justType="ter"),this.getPeople(t))})},getProblemList(e){this.problemList=[],this.justProblem=[];let t="";this.$postHttp(this.$baseUrl+"/CMS/agreementquestionmanagement/getQuestion",{}).then(i=>{console.log("getQuestion",i),200==i.data.code&&(this.problemList=i.data.data.question,console.log("this.problemList",this.problemList),console.log("problemList",e),this.justProblem=this.problemList.filter(t=>!e.some(e=>e.id===t.id)),console.log("justProblem",this.justProblem),this.$postHttp(this.$baseUrl+"/CMS/agreementquestionmanagement/getQuestion",{id:this.justProblem[0].id}).then(e=>{console.log("获取当前这条问题的信息",e),200==e.data.code&&(e.data.data.question[0].conperson==this.userName?(t=e.data.data.question[0].contractor,this.justType="con"):e.data.data.question[0].supPerson==this.userName?(t=e.data.data.question[0].supervisory_unit,this.justType="sup"):(t=e.data.data.question[0].territorial_unit,this.justType="ter"),this.getPeople(t))}))}).catch(e=>{})},getPeople(e){this.forward=[],this.$getHttp(`${this.$baseUrl}/OS-PM/organization/findUserByOrgName/${e}`).then(e=>{console.log("findUserByOrgName",e),200==e.status&&e.data.forEach(e=>{const t={text:e.userName,value:e.id};this.forward.push(t)})}).catch(e=>{})},async init(e,t){this.titleText=1==t?"问题处理":"问题验证",this.questionId=e,await this.getUserName(),this.getCurProblem(e)},reset(){this.userName="",this.pictureId=[],this.problemImg=[],this.forward=[],this.forwardTitle="",this.forwardValue="",this.completion=[],this.completionTitle="",this.completionValue="",this.description=""}},mounted(){}},r=l,c=(i("8614"),i("2877")),u=Object(c["a"])(r,a,n,!1,null,"bfae71c4",null);t["a"]=u.exports},"75a2":function(e,t,i){e.exports=i.p+"img/hook.e21e21be.svg"},"81a9":function(e,t,i){e.exports=i.p+"img/add_img.ca323127.svg"},8614:function(e,t,i){"use strict";i("9c64")},"8a32":function(e,t,i){e.exports=i.p+"img/date.6d33281b.svg"},9964:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"problem-mange-details"},[t("div",{staticClass:"title"},[t("navBar",{attrs:{titleText:"问题详情",svgIconRight:e.deleteSvg},on:{clickRight:e.openDelete}})],1),t("div",{staticClass:"problem-mange-body"},[t("van-cell",{attrs:{center:"",title:"合同名称",label:e.info.agreementName?e.info.agreementName:"无"}}),t("van-cell",{attrs:{center:"",title:"合同编号",label:e.info.agreementCode?e.info.agreementCode:"无"}}),t("van-cell",{attrs:{center:"",title:"服务类型",label:e.info.agreementCategory?e.info.agreementCategory:"无"}}),t("van-cell",{attrs:{center:"",title:"问题类型一",label:e.info.oneCategory?e.info.oneCategory:"无"}}),t("van-cell",{attrs:{center:"",title:"问题类型二",label:e.info.twoCategory?e.info.twoCategory:"无"}}),t("van-cell",{attrs:{center:"",title:"违反条例",label:e.info.confContent?e.info.confContent:"无"}}),t("van-cell",{attrs:{center:"",title:"违反文件",label:e.info.programFileName?e.info.programFileName:"无"}}),t("van-cell",{attrs:{center:"",title:"问题大小分类",label:e.info.questionSize?e.info.questionSize:"无"}}),t("van-cell",{attrs:{center:"",title:"赋予分值",label:e.info.score?e.info.score:"无"}}),t("van-cell",{attrs:{center:"",title:"检查单位",label:e.info.check_contractor?e.info.check_contractor:"无"}}),t("van-cell",{attrs:{center:"",title:"检查人",label:e.info.check_user?e.info.check_user:"无"}}),t("van-cell",{attrs:{center:"",title:"检查日期",label:e.info.checkTime?e.info.checkTime:"无"}}),t("van-cell",{attrs:{center:"",title:"项目名称",label:e.info.project_name?e.info.project_name:"无"}}),t("van-cell",{attrs:{center:"",title:"项目编码",label:e.info.project_code?e.info.project_code:"无"}}),t("van-cell",{attrs:{center:"",title:"监理单位",label:e.info.supervisory_unit?e.info.supervisory_unit:"无"}}),t("van-cell",{attrs:{center:"",title:"承包商",label:e.info.contractor?e.info.contractor:"无"}}),t("van-cell",{attrs:{center:"",title:"属地单位",label:e.info.territorial_unit?e.info.territorial_unit:"无"}}),t("van-cell",{attrs:{center:"",title:"问题归类",label:e.info.question_category?e.info.question_category:"无"}}),t("van-cell",{attrs:{center:"",title:"问题专业",label:e.info.question_major?e.info.question_major:"无"}}),t("van-cell",{attrs:{center:"",title:"问题描述",label:e.info.question_content?e.info.question_content:"无"}}),[t("div",{staticClass:"view-image-box"},[t("p",[e._v("问题图片")]),t("van-uploader",{attrs:{deletable:!1,"show-upload":!1,multiple:"",disabled:""},model:{value:e.info.file,callback:function(t){e.$set(e.info,"file",t)},expression:"info.file"}})],1)],t("van-cell",{attrs:{center:"",title:"甲方项目负责人",label:e.info.a_boss?e.info.a_boss:"无"}}),t("van-cell",{attrs:{center:"",title:"甲方监护人",label:e.info.a_guardian?e.info.a_guardian:"无"}}),t("van-cell",{attrs:{center:"",title:"乙方项目负责人",label:e.info.b_boss?e.info.b_boss:"无"}}),t("van-cell",{attrs:{center:"",title:"乙方监护人",label:e.info.b_guardian?e.info.b_guardian:"无"}}),t("van-cell",{attrs:{center:"",title:"承包商责任",label:e.handleBackStr(e.info.contractor_director)?e.handleBackStr(e.info.contractor_director):"无"}}),t("van-cell",{attrs:{center:"",title:"监理单位责任",label:e.handleBackStr(e.info.supervisory_director)?e.handleBackStr(e.info.supervisory_director):"无"}}),t("van-cell",{attrs:{center:"",title:"属地单位责任",label:e.handleBackStr(e.info.territorial_director)?e.handleBackStr(e.info.territorial_director):"无"}}),t("van-cell",{attrs:{center:"",title:"扣分",label:e.info.koufen?e.info.koufen:"无"}}),t("van-cell",{attrs:{center:"",title:"要求完成时间",label:e.info.overTime?e.info.overTime:"无"}}),t("van-cell",{attrs:{center:"",title:"考核金额",label:e.info.money?e.info.money:"无"}}),t("van-cell",{attrs:{center:"",title:"是否现场完成",label:e.isScene?"是":"否"}}),t("van-cell",{attrs:{center:"",title:"是否违反六大禁令",label:e.info.banId?e.info.banId:"否"}}),t("van-cell",{attrs:{center:"",title:"是否违反员工不安全行为",label:e.info.personId?e.info.personId:"否"}}),t("van-cell",{attrs:{center:"",title:"是否违反承包商人员不安全行为",label:e.info.cpersonId?e.info.cpersonId:"否"}}),t("hr",{staticStyle:{color:"#F3F3F3"}}),e._l(e.person,(function(i,a){return t("div",{key:a},[t("van-cell",{attrs:{center:"",title:i.personType,label:i.personName}}),t("van-cell",{attrs:{center:"",title:"问题整改完成时间",label:i.overTime}}),[t("div",{staticClass:"view-image-box"},[t("p",[e._v("问题图片")]),t("van-uploader",{attrs:{deletable:!1,"show-upload":!1,multiple:"",disabled:""},model:{value:i.file,callback:function(t){e.$set(i,"file",t)},expression:"item.file"}})],1)]],2)}))],2),0!=e.btnSTate?t("div",{staticClass:"float-button"},[t("van-button",{attrs:{type:"info"},on:{click:function(t){return e.to(e.btnSTate)}}},[t("img",{attrs:{src:1==e.btnSTate?e.hook:e.doubleHook}}),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.btnTextVisible,expression:"!btnTextVisible"}]},[1==e.btnSTate?t("span",[e._v("问题处理")]):e._e(),2==e.btnSTate?t("span",[e._v("问题验证")]):e._e()])])],1):e._e(),t("van-popup",{style:{width:"70%",padding:"1rem"},attrs:{round:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("h3",[e._v("删除问题")]),t("p",{staticStyle:{margin:"1rem 0rem"}},[e._v("你确定删除该问题？该操作不可撤销")]),t("p",{staticStyle:{"text-align":"right"}},[t("van-button",{staticStyle:{border:"'none'"},on:{click:function(t){e.show=!1}}},[e._v("取消")]),t("van-button",{attrs:{round:"",type:"danger"},on:{click:e.mustDel}},[e._v("删除")])],1)]),t("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:e.handlingShow,callback:function(t){e.handlingShow=t},expression:"handlingShow"}},[t("problemHandling",{ref:"problemHandling",on:{changeCloseHandling:e.changeCloseHandling}})],1)],1)},n=[],o=i("da1d"),s=i("38ce"),l={name:"ProblemMangeDetails",components:{navBar:o["a"],problemHandling:s["a"]},computed:{isScene(){return 1==this.person.length},btnSTate(){var e=0;return"EDIT"!=this.info.state||this.info.conperson!=this.userName&&this.info.supPerson!=this.userName&&this.info.terPerson!=this.userName?"SAVE"==this.info.state&&this.info.checkPerson==this.userName&&(e=2):e=1,e}},data(){return{btnTextVisible:!1,show:!1,handlingShow:!1,fileList:[],person:[],info:{},userName:"",hook:i("75a2"),doubleHook:i("b65a"),deleteSvg:i("3167")}},methods:{to(e){this.handlingShow=!0,this.$nextTick(()=>{this.$refs.problemHandling.init(this.$route.query.item.id,e)})},changeCloseHandling(){this.handlingShow=!1,this.$router.push({name:"ProblemMange"})},openDelete(){this.show=!0},mustDel(){this.show=!1,this.$router.push({name:"ProblemMange"})},getProblemDetails(){this.$postHttp(this.$baseUrl+"/CMS/agreementquestionmanagement/getQuestion",{id:this.$route.query.item.id}).then(e=>{console.log("getQuestion--details",e),200==e.data.code&&(e.data.data.person.forEach(e=>{e.file=e.file.map(e=>({url:this.$baseUrl+"/CMS/upload"+e.filePath}))}),this.person=e.data.data.person,e.data.data.question[0].file=e.data.data.question[0].file.map(e=>({url:this.$baseUrl+"/CMS/upload"+e.filePath})),this.info=e.data.data.question[0],console.log("this.person",this.person,"this.info",this.info))}).catch(e=>{})},getUserName(){this.$getHttp(this.$baseUrl+"/CMS/uams/getUserInfo").then(e=>{console.log("getUserInfo",e),200==e.status&&(this.userName=e.data.name,console.log("this.userName",this.userName))})},handleBackStr(e){if(!e)return;let t="";return e.split(",").forEach(e=>{t=e.split(";")[1]+","+t}),t.slice(0,t.length-1)},changeScroll(){let e=null;this.btnTextVisible=!0,window.clearTimeout(e),e=window.setTimeout(()=>{this.btnTextVisible=!1},101)}},mounted(){this.getProblemDetails(),this.getUserName(),document.querySelector(".problem-mange-body").addEventListener("scroll",this.changeScroll)},beforeDestroy(){document.querySelector(".problem-mange-body").removeEventListener("scroll",this.changeScroll)}},r=l,c=(i("0031"),i("2877")),u=Object(c["a"])(r,a,n,!1,null,"a20ab11a",null);t["default"]=u.exports},"9c64":function(e,t,i){},b65a:function(e,t,i){e.exports=i.p+"img/doubleHook.6a8b4cf3.svg"},bf37:function(e,t,i){e.exports=i.p+"img/close.e7685cae.svg"},fab1:function(e,t,i){}}]);
//# sourceMappingURL=chunk-2049c7a0.7a46b471.js.map