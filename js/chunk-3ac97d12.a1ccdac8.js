(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ac97d12"],{"1be4":function(t,e,s){var i=s("d066");t.exports=i("document","documentElement")},"24e1":function(t,e,s){},3103:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"examine"},[e("navBar",{attrs:{svgIcon:t.svgIcon,titleText:t.titleText},on:{changeClose:t.changeClose}}),e("div",{staticClass:"examine-body"},["审核"==t.titleText?e("div",[e("p",[t._v("审批流程")]),e("van-dropdown-menu",{attrs:{"get-container":"body"}},[e("van-dropdown-item",{attrs:{title:t.processTitle,options:t.processOption,disabled:""},on:{change:t.handelChange},model:{value:t.processValue,callback:function(e){t.processValue=e},expression:"processValue"}})],1),e("p",[t._v("审批意见")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],attrs:{cols:"30",rows:"5",placeholder:"请输入"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),t._m(0),e("van-dropdown-menu",{attrs:{"get-container":"body",overlay:!1}},[e("van-dropdown-item",{attrs:{title:t.resultTitle},on:{open:t.handelOpen}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:"同意"==t.resultTitle&&t.isShowNextPrincipals,expression:"resultTitle == '同意' && isShowNextPrincipals"}]},t._l(t.principalss,(function(s,i){return e("div",{key:i},[e("p",[t._v(t._s(s.custom)+"审批人 "),e("span",{staticStyle:{color:"#f20909"}},[t._v("*")])]),e("van-dropdown-menu",{attrs:{"get-container":"body",overlay:!0,direction:i>=2?"up":"down"}},[e("van-dropdown-item",{attrs:{title:t.subForm.principalsOptionTitle,options:t.principalsOption[i]},on:{change:t.selectPeople},model:{value:t.subForm.principals[i],callback:function(e){t.$set(t.subForm.principals,i,e)},expression:"subForm.principals[index]"}})],1)],1)})),0),e("van-popup",{style:{height:"25.5%"},attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},t._l(t.btnList,(function(s,i){return e("van-cell",{key:i,attrs:{"is-link":"",center:"",title:s,label:""},on:{click:function(e){return t.handelBtn(s)}}})})),1)],1):e("div",[t._m(1),e("van-dropdown-menu",{attrs:{"get-container":"body",overlay:!1}},[e("van-dropdown-item",{attrs:{title:t.workflowTemplatesTitle,options:t.workflowTemplates},on:{change:t.selectWorkflow},model:{value:t.workflowTemplatesValue,callback:function(e){t.workflowTemplatesValue=e},expression:"workflowTemplatesValue"}})],1),t._l(t.principalss,(function(s,i){return e("div",{key:i},[e("p",[t._v(t._s(s.custom)+"审批人 "),e("span",{staticStyle:{color:"#f20909"}},[t._v("*")])]),e("van-dropdown-menu",{attrs:{"get-container":"body",overlay:!0,direction:i>=2?"up":"down"}},[e("van-dropdown-item",{attrs:{title:t.subForm.principalsOptionTitle,options:t.principalsOption[i]},on:{change:t.selectSubPeople},model:{value:t.subForm.principals[i],callback:function(e){t.$set(t.subForm.principals,i,e)},expression:"subForm.principals[index]"}})],1)],1)})),e("p",[t._v("描述")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],attrs:{cols:"30",rows:"5",placeholder:"请输入"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})],2),e("van-button",{directives:[{name:"show",rawName:"v-show",value:t.btnShow,expression:"btnShow"}],attrs:{round:"",type:"info",block:""},on:{click:t.submit}},[t._v("提交")])],1)],1)},o=[function(){var t=this,e=t._self._c;return e("p",[t._v("审批结果 "),e("span",{staticStyle:{color:"#f20909"}},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("p",[t._v("工作流模板 "),e("span",{staticStyle:{color:"#f20909"}},[t._v("*")])])}],n=(s("bc3a"),s("da1d")),a=s("f564"),l={name:"Examine",components:{navBar:n["a"]},watch:{"$store.state.btnShow"(t){console.log("watch",t),this.btnShow=t}},data(){return{titleText:"审核",value:"",title:"请选择",resultTitle:"请选择",processValue:"",processTitle:"请选择",processOption:[],whichUnit:"",labels:{},peopleTitle:"",peopleOption:[],svgIcon:s("bf37"),show:!1,btnList:["同意","不同意","回退至上一步"],description:"",approvalId:null,businessId:null,isShowNextPrincipals:!1,flows:[],nodesData:[],orgValue:"",currentNode:"",isOnLastPoint:!1,principalss:[],nextPrincipals:[{userId:""}],flowAction:"",annotation:"",isNumberOne:!1,workflowTemplatesValue:"",workflowTemplatesTitle:"",workflowTemplates:[],subForm:{principals:[],principalsOptionTitle:""},principalsOption:[],principal:{},principals:[],btnShow:!0}},methods:{changeClose(){this.$emit("changeClose")},handelChange(t){this.processOption.forEach(e=>{e.value===t&&(this.processTitle=e.text,this.processValue=t,this.labels=e.labels)}),this.getApprovalFlowTemplates(t)},handelOpen(){this.show=!0},handelBtn(t){if(this.isNumberOne&&"回退至上一步"==t)return alert("当前节点不可用"),void(this.show=!1);this.resultTitle=t,this.show=!1,this.flowAction="同意"==t?"AGREE":"不同意"==t?"DISAGREE":"回退至上一步"==t?"ROLLBACK":""},selectPeople(t){},selectWorkflow(t){this.subForm.principals=[],this.workflowTemplates.forEach(e=>{e.value===t&&(this.workflowTemplatesTitle=e.text,this.workflowTemplatesValue=t)}),this.getApprovalFlowTemplates(t)},selectSubPeople(t){},submit(){if(console.log("isShowNextPrincipals",this.isShowNextPrincipals),"审核"==this.titleText){if("请选择"==this.resultTitle)return void alert("请选择审批结果");if("同意"==this.resultTitle&&this.isShowNextPrincipals&&this.subForm.principals&&this.subForm.principals.length!=this.principalss.length)return void alert("请选择审批人");"不同意"!=this.resultTitle&&"回退至上一步"!=this.resultTitle||(this.nextPrincipals=[])}else if(0==this.subForm.principals.length)return void alert("请选择审批人");if("审核"==this.titleText){let t=[];this.subForm.principals.forEach(e=>{t.push({userId:e})});const e=new FormData;e.append("nextPrincipals",JSON.stringify(t)),e.append("flowAction",this.flowAction),e.append("annotation",this.resultTitle+"。"+this.description),this.$postHttp(`${this.$baseUrl}/OS-PM/approvalFlow/approvals/${this.approvalId}`,e).then(t=>{console.log("提交成功，同意、回退至上一步",t),t.status}).catch(t=>{Object(a["a"])({type:"danger",message:t.response.data.message})})}else{let t=[];this.subForm.principals.forEach(e=>{t.push({userId:e})});let e={templateId:this.workflowTemplatesValue,principals:JSON.stringify(t),description:"回退重审。"+this.description,createdStateName:"提交送审"};this.$putHttp(`${this.$baseUrl}/OS-PM/versions/${window.localStorage.getItem("versionId")}/approvalFlow/approvals/${this.approvalId}/updated`,e,{isFormData:!0}).then(t=>{console.log("updated",t),t.status}).catch(t=>{})}this.$router.push({name:"WaitDealt"})},async examineInit(t,e,s,i){this.reset(),this.titleText="审核",this.principal=i,"方案管理"==t&&(this.orgValue=s.auditOrganization),this.approvalId=e,this.getApprovalFlowExample(e);let o=await this.$getHttp(`${this.$baseUrl}/OS-PM/approvalFlow/approvals/${e}/isOnLastPoint`);console.log("retrunData",o),this.isOnLastPoint=o.data,console.log("this.isOnLastPoint",this.isOnLastPoint)},getApprovalFlowExample(t){this.$getHttp(`${this.$baseUrl}/OS-PM/approvalFlow/approvals/${t}`).then(t=>{if(console.log("获取指定审批流实例",t),200==t.status){this.businessId=t.data.businessId,this.getApprovalFlowTemplates(t.data.templateId,t.data.currentApprovalPointId);let e=0;t.data.principals.forEach(t=>{t.usedFlowAction&&"AGREE"===t.usedFlowAction&&e++}),this.isShowNextPrincipals=e===t.data.principals.length-1}}).catch(t=>{})},getApprovalFlowTemplates(t,e){this.$getHttp(`${this.$baseUrl}/OS-PM/approvalFlow/templates/${t}`).then(t=>{if(200==t.status){if(this.processTitle=t.data.name,t.data.approvalPoints.forEach(t=>{t.id==e&&(this.whichUnit=t.principals[0].custom)}),this.flows=t.data.flows,this.nodesData=t.data.approvalPoints,this.nodesData.forEach(t=>{t.numberBefore=""}),t.data.flows.forEach(t=>{const e=this.nodesData.findIndex(e=>e.id===t.srcApprovalPointId)+1,s=this.nodesData.findIndex(e=>e.id===t.destApprovalPointId);this.nodesData[s].numberBefore=0===e?"":e}),this.isNumberOne=this.isNumberOnePoint(e),console.log("this.isNumberOne",this.isNumberOne),"重审"==this.titleText){let t=-1;this.nodesData.forEach((e,s)=>{""!==e.numberBefore||(t=s)}),this.principalss=this.nodesData[t].principals}else if(console.log("到这了吗"),!this.isOnLastPoint){let t=-1,s=-1;this.flows.forEach((t,i)=>{t.srcApprovalPointId!==e||(s=t.destApprovalPointId)}),console.log("真呢"),this.nodesData.forEach((e,i)=>{e.id!==s||(t=i)}),-1!==t&&(this.principalss=this.nodesData[t].principals)}console.log("this.principalss",this.principalss,"this.principal",this.principal);for(let t=0;t<this.principalss.length;t++){const e=this.principalss[t];if(this.principalsOption[t]=[],"STATIC"===e.orgType)console.log("element.orgType",e.orgType),this.getFindOrgName(t,e.orgValue);else{let s=!1;for(const i in this.principal)if(i===e.orgValue){s=!0;let e=this.principal[i].split(",");for(let s=0;s<e.length;s++)this.getFindOrgName(t,e[s]);let o=new Map;for(let s of this.principalsOption[t])o.set(s.id,s);this.$set(this.principalsOption,t,[...o.values()])}}}}console.log("指定审批流模板",t)}).catch(t=>{})},isNumberOnePoint(t){let e=!1;const s=this.nodesData.findIndex(e=>e.id===t);return-1!==s&&(e=""===this.nodesData[s].numberBefore),e},getFindOrgName(t,e){this.$postHttp(`${this.$baseUrl}/OS-PM/organization/findOrgNameByOrg/${e}`).then(e=>{console.log("findOrgNameByOrg",e),200==e.status&&this.getUsers(t,e.data)})},getUsers(t,e){this.peopleOption=[],this.principalsOption[t]=[];let s=[];this.$postHttp(this.$baseUrl+"/OS-PM/organization/getUsers",{orgId:e}).then(e=>{console.log("getUsers",e),200==e.status&&(e.data.results.forEach(t=>{const e={text:t.userName,value:t.id};this.peopleOption.push(e),s.push(e)}),this.$set(this.principalsOption,t,[...this.principalsOption[t],...s]),console.log("this.principalsOption[index].push(obj);",this.principalsOption))})},async submitInit(t,e,s){this.reset(),this.titleText="重审",this.principal=s,this.approvalId=e;let i=await this.$getHttp(this.$baseUrl+"/OS-PM/approvalFlow/templates",{params:{labels:{"流程所属模块":t}}});i.data.results.forEach(t=>{const e={text:t.name,value:t.id,labels:t.labels};this.workflowTemplates.push(e)}),this.workflowTemplates&&(this.workflowTemplatesTitle=this.workflowTemplates[0].text,this.workflowTemplatesValue=this.workflowTemplates[0].value,this.getApprovalFlowTemplates(this.workflowTemplates[0].value)),console.log("this.workflowTemplates",this.workflowTemplates)},reset(){this.processValue="",this.processTitle="请选择",this.processOption=[],this.description="",this.resultTitle="请选择",this.workflowTemplates=[],this.workflowTemplatesTitle="",this.subForm.principals=[]}}},r=l,p=(s("76db"),s("2877")),c=Object(p["a"])(r,i,o,!1,null,"5ecc9b70",null);e["default"]=c.exports},"37e8":function(t,e,s){var i=s("83ab"),o=s("aed9"),n=s("9bf2"),a=s("825a"),l=s("fc6a"),r=s("df75");e.f=i&&!o?Object.defineProperties:function(t,e){a(t);var s,i=l(e),o=r(e),p=o.length,c=0;while(p>c)n.f(t,s=o[c++],i[s]);return t}},"44d2":function(t,e,s){var i=s("b622"),o=s("7c73"),n=s("9bf2").f,a=i("unscopables"),l=Array.prototype;void 0==l[a]&&n(l,a,{configurable:!0,value:o(null)}),t.exports=function(t){l[a][t]=!0}},"707f":function(t,e,s){},"76db":function(t,e,s){"use strict";s("24e1")},"7c73":function(t,e,s){var i,o=s("825a"),n=s("37e8"),a=s("7839"),l=s("d012"),r=s("1be4"),p=s("cc12"),c=s("f772"),h=">",u="<",d="prototype",f="script",m=c("IE_PROTO"),v=function(){},w=function(t){return u+f+h+t+u+"/"+f+h},g=function(t){t.write(w("")),t.close();var e=t.parentWindow.Object;return t=null,e},b=function(){var t,e=p("iframe"),s="java"+f+":";return e.style.display="none",r.appendChild(e),e.src=String(s),t=e.contentWindow.document,t.open(),t.write(w("document.F=Object")),t.close(),t.F},T=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}T="undefined"!=typeof document?document.domain&&i?g(i):b():g(i);var t=a.length;while(t--)delete T[d][a[t]];return T()};l[m]=!0,t.exports=Object.create||function(t,e){var s;return null!==t?(v[d]=o(t),s=new v,v[d]=null,s[m]=t):s=T(),void 0===e?s:n.f(s,e)}},bf37:function(t,e,s){t.exports=s.p+"img/close.e7685cae.svg"},caad:function(t,e,s){"use strict";var i=s("23e7"),o=s("4d64").includes,n=s("d039"),a=s("44d2"),l=n((function(){return!Array(1).includes()}));i({target:"Array",proto:!0,forced:l},{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),a("includes")},d93d:function(t,e,s){t.exports=s.p+"img/left_back.cec8506f.svg"},da1d:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nav-bar"},[e("van-nav-bar",{on:{"click-left":t.clickLeft,"click-right":t.clickRight},scopedSlots:t._u([{key:"left",fn:function(){return[e("img",{attrs:{src:t.svgIcon}})]},proxy:!0},{key:"title",fn:function(){return[t._v(" "+t._s(t.titleText)+" "),t._t("default")]},proxy:!0},{key:"right",fn:function(){return[e("img",{attrs:{src:t.svgIconRight}})]},proxy:!0}],null,!0)})],1)},o=[],n=(s("caad"),{name:"NavBar",props:{svgIcon:{type:String,default:()=>s("d93d")},svgIconRight:{type:String,default:()=>""},titleText:{type:String,default:()=>""}},data(){return{}},methods:{clickLeft(){this.svgIcon.includes("close")?this.$emit("changeClose"):this.$router.back()},clickRight(){this.$emit("clickRight")}}}),a=n,l=(s("f1f8"),s("2877")),r=Object(l["a"])(a,i,o,!1,null,"28ca8737",null);e["a"]=r.exports},df75:function(t,e,s){var i=s("ca84"),o=s("7839");t.exports=Object.keys||function(t){return i(t,o)}},f1f8:function(t,e,s){"use strict";s("707f")}}]);
//# sourceMappingURL=chunk-3ac97d12.a1ccdac8.js.map